<header class="posts-header" style = "background-image: url(<%= @post.photo.url %>)">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <div class="transbox">
          <h1> <%= @post.title.capitalize %> </h1>
          <p class = "post-author"> By <%= link_to @post.user.username, user_path(@post.user_id) %> </p>
          <p class = "post-time"> <%= @post.created_at.strftime(" %b. %d, %Y") %></p>
        </div>

        <div class = "col-xs-6 col-xs-offset-4 col-s-6 col-s-offset-4 col-md-6 col-md-offset-5">
          <div class = "btn-larg" id = "edit">
            <% if current_user %>
              <% if current_user.id == @post.user_id %>
                <%= link_to 'Edit post', edit_post_path(@post), class: "btn btn-primary" %>
              <% end %>
            <% end %>
          </div>

          <div class = "btn-lrg" id="favorites">
            <% if current_user %>
              <% if current_user != @post.user_id %>
                <% unless current_user.favorite_posts.exists?(id: @post.id) %>
                  <%= link_to 'Add post to favorites', post_favorite_posts_path(post_id: @post), method: :post, class: "btn btn-primary" %>
                <% else %>
                  <%= link_to 'Remove Favorite', post_favorite_post_path(post_id:@post.id, favorite_post_id: @post.id), method: :delete, class: "btn btn-default" %>
                <% end %>
              <% end %>

              <% @post.average_rating.times do %>
                <%= image_tag("star.png", size: "20x20", class: "img-rounded img-responsive") %>
              <% end %></p>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

<div class = "container">

  <div class = "col-xs-12 col-sm-12 col-m-12">
    <p id = "post-body"> <%= @post.body.html_safe  %></p>
    <p>Tags : <% @post.tags.map do |tag| %>
      <%= link_to tag.title, tags_path(tag.title), class: "index-post-link" %>, 
      <% end %>
    </p>
  </div>

  <div id="profile-content" class="col-xs-12 col-s-12 col-md-12">
    <ul class = "nav nav-tabs" role = "tablist">
      <li role="presentation" class="active"><a href="#post-post" aria-controls="post-post" role="tab" data-toggle="tab"> Posts in <%= @post.category.category_name %></a></li>
      <li role="presentation"><a href="#post-reviews" aria-controls="post-reviews" role="tab" data-toggle="tab">Reviews (<%= @post.reviews.count %>)</a></li>
    </ul>

   <div class = "tab-content">
    <div role="tabpanel" class="tab-pane fade in active" id="post-post">
        <ol>
          <% @postcat.each do |post| %>
          <li><p><%= link_to post.title, post_path(post.id) %></p>
              <p> by <%= link_to post.user.username, user_path(post.user_id) %></p>
          </li>

          <% end %>
        </ol>
      </div>

      <div role="tabpanel" class="tab-pane fade" id="post-reviews">
        <ul>
        <% unless current_user == @post.user_id %>
        <p><%= link_to "Add a Review", new_post_review_path(@post), class: "btn btn-default" %></p>
        <% end %>
        <% if @post.reviews.exists? %>
          <% @post.reviews.each do |review| %>
          <li>Rating:
            <% review.score.times do %>
            <%= image_tag("star.png", size: "20x20") %>
            <% end %>
          </li>

          <li>From <%=link_to review.reviewer.username, user_path(review.reviewer) %>
            on <%= review.created_at.strftime("%B %d, %Y") %> <br>
            <%= review.body %>
            <p><% if review.user_id == current_user.id %>
              <%= link_to "Delete Review", post_review_path(post_id: @post, id: review), method: :delete %></p>
              <% end %>
            </li>
            <% end %>
          <% else %>
            <p> This post has no reviews. </p>
          <% end %>
        </ul>
      </div>
    </div>
  </div
</div>